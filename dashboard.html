<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - GoathBet</title>
  <link rel="stylesheet" href="style.css">
  <script type="module" src="firebase.js"></script>
  <style>
    body { background:#0a0a0f; color:#fff; font-family:'Poppins',sans-serif; margin:0; }

    /* ===== ICON CARDS ===== */
    .icon-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
      gap: 15px;
      margin: 20px auto;
      max-width: 400px;
    }
    .icon-card {
      background: #1c1c2b;
      font-size: 1.8rem;
      display: flex; align-items: center; justify-content: center;
      border-radius: 12px; height: 70px; cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      transition: 0.3s; color: #fff;
    }
    .icon-card:hover { background:#27ae60; transform:scale(1.05); }

    /* Conte√∫do */
    .card-conteudo { display:none; background:#1c1c2b; padding:15px; margin:10px auto;
      border-radius:12px; max-width:1000px; box-shadow:0 4px 15px rgba(0,0,0,0.4); }
    .card-conteudo.ativo { display:block; }

    /* Velas */
    .grid-velas { display:flex; flex-wrap:wrap; gap:8px; }
    .vela { padding:10px; border-radius:6px; min-width:60px; text-align:center; font-weight:bold; }
    .vela.green{background:#145a32;} .vela.red{background:#641e16;}

    /* Timer flutuante */
    #timer-floating { position:fixed; bottom:20px; right:20px; background:linear-gradient(135deg,#27ae60,#2ecc71);
      color:#fff; font-weight:bold; padding:18px; border-radius:50%; cursor:pointer;
      box-shadow:0 4px 15px rgba(0,0,0,0.6); z-index:999; animation:pulse 2s infinite; }
    @keyframes pulse {
      0% { box-shadow:0 0 0 0 rgba(39,174,96,0.7); }
      70% { box-shadow:0 0 0 20px rgba(39,174,96,0); }
      100% { box-shadow:0 0 0 0 rgba(39,174,96,0); }
    }

    /* Painel Timer */
    #painel-timer { position:fixed; bottom:0; right:-100%; width:320px; background:#1c1c2b; color:#fff; padding:25px;
      border-top-left-radius:12px; box-shadow:-6px -6px 18px rgba(0,0,0,0.6); transition:right .4s ease-in-out; z-index:1000; }
    #painel-timer.ativo { right:0; }

    /* Live bot√£o */
    #live-floating { position:fixed; bottom:20px; left:20px; background:linear-gradient(135deg,#ff0000,#c0392b);
      padding:16px; border-radius:50%; cursor:pointer; box-shadow:0 4px 15px rgba(0,0,0,0.6); z-index:999; }
    #live-floating:hover { transform:scale(1.15); }

    /* Modal Live */
    #modal-live { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.85);
      z-index:2000; justify-content:center; align-items:center; }
    #modal-live .conteudo-live { width:90%; max-width:900px; background:#111; border-radius:12px; padding:10px; }
    #modal-live iframe { border-radius:8px; width:100%; height:500px; }
    #modal-live .fechar { float:right; font-size:28px; cursor:pointer; color:#fff; }
  </style>
</head>
<body>
  <main class="dashboard-container">
    <!-- Plataforma -->
    <section class="plataforma">
      <iframe src="https://www.goathbet.com/game/spribe-aviator?r=zktgmbwl" width="100%" height="600" frameborder="0"></iframe>
    </section>

    <!-- √çcones -->
    <div class="icon-cards">
      <div class="icon-card" onclick="toggleCard('velas')">üìà</div>
      <div class="icon-card" onclick="toggleCard('relatorio')">üìä</div>
      <div class="icon-card" onclick="toggleCard('calls')">üì¢</div>
      <div class="icon-card" onclick="toggleCard('lucro')">üí∞</div>
    </div>

    <!-- Conte√∫dos -->
    <div id="card-velas" class="card-conteudo"><h2>üìà √öltimas Velas</h2><div id="gridVelas" class="grid-velas"></div></div>
    <div id="card-relatorio" class="card-conteudo"><h2>üìä Rodadas</h2><table><thead><tr><th>Hor√°rio</th><th>Mult</th><th>Status</th></tr></thead><tbody id="tabelaRodadas"></tbody></table></div>
    <div id="card-calls" class="card-conteudo"><h2>üì¢ √öltimos Calls</h2><ul id="listaCalls"></ul></div>
    <div id="card-lucro" class="card-conteudo"><h2>üí∞ Lucro Virtual</h2><h3 id="lucroVirtual">R$ 0,00</h3></div>
  </main>

  <footer>
    <p>¬© 2025 GoathBet</p><a href="admin.html">Painel Admin</a> | <a href="#" onclick="logout()">Sair</a>
  </footer>

  <!-- Timer -->
  <div id="timer-floating" onclick="abrirPainelTimer()">‚è± <span id="timer">00:00</span></div>
  <div id="painel-timer"><h2>‚è≥ Pr√≥ximo Multiplicador</h2><p><b>Hor√°rio:</b> <span id="horaProx">--:--</span></p><p><b>Esperado:</b> <span id="minProx">--</span></p><p id="msgPsico">Aguardando...</p><button onclick="fecharPainelTimer()">Fechar</button></div>

  <!-- Live -->
  <div id="live-floating" onclick="abrirLive()">‚ñ∂Ô∏è</div>
  <div id="modal-live"><div class="conteudo-live"><span class="fechar" onclick="fecharLive()">√ó</span>
    <iframe src="https://www.youtube.com/embed/SEU_ID_DA_LIVE?autoplay=1"></iframe></div></div>

  <!-- SCRIPT -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Auth
    onAuthStateChanged(auth,(user)=>{ if(!user) window.location.href="login.html"; });
    window.logout=()=>signOut(auth).then(()=>window.location.href="login.html");

    // Toggle
    window.toggleCard=(id)=>{document.querySelectorAll('.card-conteudo').forEach(c=>c.classList.remove('ativo'));document.getElementById('card-'+id).classList.add('ativo');};
    window.abrirLive=()=>document.getElementById("modal-live").style.display="flex";
    window.fecharLive=()=>document.getElementById("modal-live").style.display="none";
    window.abrirPainelTimer=()=>document.getElementById("painel-timer").classList.add("ativo");
    window.fecharPainelTimer=()=>document.getElementById("painel-timer").classList.remove("ativo");

    // Timer
    let intervaloTimer;
    function iniciarTimer(segundos, horarioLancado, multEsperado){
      pararTimer();
      const fim=new Date(horarioLancado.getTime()+segundos*1000);
      intervaloTimer=setInterval(()=>{
        const agora=new Date(); const restante=Math.floor((fim-agora)/1000);
        if(restante<=0){ document.getElementById("timer").innerText="00:00"; pararTimer(); document.getElementById("msgPsico").innerText="‚è≥ Call encerrado"; }
        else {
          document.getElementById("timer").innerText="00:"+String(restante).padStart(2,"0");
          document.getElementById("horaProx").innerText=fim.toLocaleTimeString("pt-BR");
          document.getElementById("minProx").innerText=multEsperado+"x";
          document.getElementById("msgPsico").innerText="‚ö° Em andamento!";
        }
      },1000);
    }
    function pararTimer(){ clearInterval(intervaloTimer); }

    // === Escutar Cole√ß√µes ===
    onSnapshot(doc(db,"calls","ativo"),(snap)=>{ if(snap.exists()){const d=snap.data(); if(d.status==="PENDENTE") iniciarTimer(d.tempo,d.horarioLancado.toDate(),d.multEsperado); else pararTimer(); }});

    onSnapshot(collection(db,"velas"),(snap)=>{ let html=""; snap.forEach(docSnap=>{const d=docSnap.data(); const hora=d.horario?.toDate().toLocaleTimeString("pt-BR")||"--"; html+=`<div class="vela ${d.multiplicador>=2?'green':'red'}">${d.multiplicador}x <small>${hora}</small></div>`;}); document.getElementById("gridVelas").innerHTML=html; });

    onSnapshot(collection(db,"rodadas"),(snap)=>{ let html=""; snap.forEach(docSnap=>{const d=docSnap.data(); const hora=d.horario?.toDate().toLocaleTimeString("pt-BR")||"--"; html+=`<tr><td>${hora}</td><td>${d.mult}</td><td style="color:${d.status==='GREEN'?'#2ecc71':'#e74c3c'}">${d.status}</td></tr>`;}); document.getElementById("tabelaRodadas").innerHTML=html; });

    onSnapshot(collection(db,"callsHistorico"),(snap)=>{ let html=""; snap.forEach(docSnap=>{const d=docSnap.data(); const hora=d.horario?.toDate().toLocaleTimeString("pt-BR")||"--"; html+=`<li><b>${hora}</b> ‚Üí ${d.mult}x <span style="color:${d.status==='GREEN'?'#2ecc71':'#e74c3c'}">${d.status}</span></li>`;}); document.getElementById("listaCalls").innerHTML=html; });

    onSnapshot(doc(db,"lucro","atual"),(snap)=>{ if(snap.exists()){document.getElementById("lucroVirtual").innerText="R$ "+snap.data().valor.toFixed(2);} });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - InÃ­cio</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
</head>
<body>
  <!-- SPLASH -->
  <div id="splash">
    <img src="img/foto.png" alt="GoathBet">
    <h2>Entradas Inteligentes com a Rainha do Aviator</h2>
  </div>

  <!-- HERO -->
  <section class="hero">
    <h2>ğŸ’– Bem-vinda ao <span>GoathBet</span></h2>
    <p>Os melhores sinais, relatÃ³rios e gestÃ£o para turbinar sua banca.</p>
  </section>

  <!-- HUB DE CARDS -->
  <section class="hub-modulos">
    <div class="hub-card" onclick="abrirModal('gestao')">ğŸ§® <h3>GestÃ£o Financeira</h3></div>
    <div class="hub-card" onclick="abrirModal('velas')">ğŸ“Š <h3>RelatÃ³rios de Velas</h3></div>
    <div class="hub-card" onclick="abrirModal('sinais')">ğŸ¯ <h3>Sinais de Entrada</h3></div>
    <div class="hub-card" onclick="abrirModal('sorteios')">ğŸ <h3>Sorteios</h3></div>
    <div class="hub-card" onclick="window.location.href='plano.html'">ğŸ’ <h3>Planos</h3></div>
    <div class="hub-card" onclick="entrarNoJogo()">ğŸ® <h3>Entrar no Jogo</h3></div>
  </section>

  <!-- FOOTER -->
  <footer>
    <button onclick="window.location.href='login.html'" class="btn-login">ğŸ”‘ Fazer Login</button>
    <p>Â© 2025 GoathBet - Todos os direitos reservados | Feito com ğŸ’œ</p>
  </footer>

  <!-- MODAIS -->
  <!-- GestÃ£o -->
  <div id="modal-gestao" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('gestao')">Ã—</span>
      <h2>ğŸ§® GestÃ£o Financeira</h2>
      <p>Controle sua banca:</p>
      <input type="number" id="bancaInicial" placeholder="Banca inicial (R$)">
      <input type="number" id="valorEntrada" placeholder="Valor por entrada (R$)">
      <p id="resultadoGestao"></p>
      <button onclick="calcularGestao()">Calcular</button>
    </div>
  </div>

  <!-- Velas -->
  <div id="modal-velas" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('velas')">Ã—</span>
      <h2>ğŸ“Š Ãšltimas Velas</h2>
      <div id="gridVelas"></div>
    </div>
  </div>

  <!-- Sinais -->
  <div id="modal-sinais" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sinais')">Ã—</span>
      <h2>ğŸ¯ Sinais de Entrada</h2>
      <ul id="listaSinais"></ul>
    </div>
  </div>

  <!-- Sorteios -->
  <div id="modal-sorteios" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sorteios')">Ã—</span>
      <h2>ğŸ Sorteios Ativos</h2>
      <ul id="listaSorteios"></ul>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Splash
    window.addEventListener("load", () => {
      setTimeout(()=>{ document.getElementById("splash").style.display="none"; }, 2500);
    });

    // Abrir/Fechar Modais
    window.abrirModal = (id)=>document.getElementById("modal-"+id).style.display="flex";
    window.fecharModal = (id)=>document.getElementById("modal-"+id).style.display="none";

    // GestÃ£o financeira simples
    window.calcularGestao = () => {
      const banca = parseFloat(document.getElementById("bancaInicial").value)||0;
      const entrada = parseFloat(document.getElementById("valorEntrada").value)||0;
      if (banca>0 && entrada>0){
        document.getElementById("resultadoGestao").innerText =
          `VocÃª pode fazer ${Math.floor(banca/entrada)} entradas de R$${entrada.toFixed(2)}.`;
      }
    };

    // Velas em tempo real
    onSnapshot(collection(db,"velas"),(snap)=>{
      const grid=document.getElementById("gridVelas"); grid.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        grid.innerHTML+=`<div>${d.multiplicador}x <small>${hora}</small></div>`;
      });
    });

    // Sinais em tempo real
    onSnapshot(collection(db,"callsHistorico"),(snap)=>{
      const ul=document.getElementById("listaSinais"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        ul.innerHTML+=`<li>${hora} â†’ ${d.mult}x <span style="color:${d.status==='GREEN'?'#2ecc71':'#e74c3c'}">${d.status}</span></li>`;
      });
    });

    // Sorteios em tempo real
    onSnapshot(collection(db,"sorteios"),(snap)=>{
      const ul=document.getElementById("listaSorteios"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        ul.innerHTML+=`<li>${d.nome} - ${d.status}</li>`;
      });
    });

    // Entrar no jogo â†’ sÃ³ se tiver login + plano ativo
    window.entrarNoJogo = () => {
      onAuthStateChanged(auth, async (user)=>{
        if(!user){
          window.location.href="login.html";
        } else {
          const ref = doc(db,"assinaturas",user.uid);
          const snap = await getDoc(ref);
          if(snap.exists() && snap.data().status==="ATIVO"){
            window.location.href="dashboard.html";
          } else {
            window.location.href="plano.html";
          }
        }
      });
    };
  </script>
</body>
</html>
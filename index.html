<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - Início</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
</head>
<body>
  <!-- TOPO -->
  <header class="topbar">
    <div class="logo">
      <img src="img/logo.png" alt="GoathBet" height="45">
      <h1>GOATH<span>BET</span></h1>
    </div>
    <nav>
      <a href="index.html" class="ativo">Início</a>
      <a href="login.html" id="btnEntrar" class="btn-login">Entrar</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h2>🚀 Bem-vindo ao <span>GoathBet</span></h2>
    <p>Os melhores sinais, relatórios e ferramentas para turbinar sua gestão no Aviator.</p>
  </section>

  <!-- CARDS PRINCIPAIS -->
  <section class="cards-container">
    <!-- Gestão Financeira -->
    <div class="card">
      <h3>🧮 Gestão Financeira</h3>
      <p>Controle sua banca e descubra o valor ideal de cada entrada.</p>
      <button onclick="abrirCard('gestao')">Abrir Gestão</button>
    </div>

    <!-- Sinais de Entrada -->
    <div class="card">
      <h3>🎯 Sinais de Entrada</h3>
      <p>Acompanhe os calls inteligentes lançados em tempo real.</p>
      <button onclick="abrirCard('sinais')">Ver Sinais</button>
    </div>

    <!-- Sorteios -->
    <div class="card">
      <h3>🎁 Sorteios</h3>
      <p>Participe de sorteios exclusivos para membros ativos.</p>
      <button onclick="abrirCard('sorteios')">Participar</button>
    </div>

    <!-- Planos -->
    <div class="card">
      <h3>💳 Assine um Plano</h3>
      <p>Ative sua conta para ter acesso completo ao jogo e relatórios.</p>
      <a href="plano.html"><button>Ver Planos</button></a>
    </div>

    <!-- Jogo -->
    <div class="card">
      <h3>🎮 Jogar Agora</h3>
      <p>Acesse o Aviator com sinais integrados e relatórios em tempo real.</p>
      <button onclick="entrarNoJogo()">Ir para o Jogo</button>
    </div>
  </section>

  <!-- MODAIS -->
  <div id="card-gestao" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharCard('gestao')">×</span>
      <h2>🧮 Calculadora de Gestão</h2>
      <p>Digite sua banca inicial:</p>
      <input type="number" id="banca" placeholder="Ex: 1000">
      <button onclick="calcularGestao()">Calcular</button>
      <div id="resultadoGestao"></div>
    </div>
  </div>

  <div id="card-sinais" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharCard('sinais')">×</span>
      <h2>🎯 Últimos Sinais</h2>
      <ul id="listaSinais"></ul>
    </div>
  </div>

  <div id="card-sorteios" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharCard('sorteios')">×</span>
      <h2>🎁 Sorteios Ativos</h2>
      <p>Em breve novos sorteios exclusivos para assinantes.</p>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    <p>© 2025 GoathBet - Todos os direitos reservados</p>
  </footer>

  <!-- SCRIPTS -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const btnEntrar = document.getElementById("btnEntrar");

    // Autenticação
    onAuthStateChanged(auth, (user) => {
      if (user) {
        btnEntrar.innerText = "Sair";
        btnEntrar.onclick = () => signOut(auth);
      }
    });

    // Abrir/Fechar Cards
    window.abrirCard = (id) => document.getElementById("card-" + id).style.display = "flex";
    window.fecharCard = (id) => document.getElementById("card-" + id).style.display = "none";

    // Gestão simples
    window.calcularGestao = () => {
      const banca = parseFloat(document.getElementById("banca").value);
      if (!banca || banca <= 0) {
        document.getElementById("resultadoGestao").innerHTML = "<p style='color:red'>Informe um valor válido</p>";
        return;
      }
      const valorEntrada = (banca * 0.02).toFixed(2); // 2% da banca
      document.getElementById("resultadoGestao").innerHTML = `<p>Entrada recomendada: R$ ${valorEntrada}</p>`;
    };

    // Verificação de acesso ao jogo
    async function verificarAssinatura(user) {
      const ref = doc(db, "assinaturas", user.uid);
      const snap = await getDoc(ref);
      if (snap.exists()) {
        const dados = snap.data();
        const validade = dados.validade?.toDate() || new Date(0);
        if (dados.status === "ATIVO" && validade > new Date()) {
          return true;
        }
      }
      return false;
    }

    window.entrarNoJogo = () => {
      onAuthStateChanged(auth, async (user) => {
        if (!user) {
          window.location.href = "login.html";
        } else {
          const ok = await verificarAssinatura(user);
          if (!ok) {
            window.location.href = "plano.html";
          } else {
            window.location.href = "dashboard.html";
          }
        }
      });
    };
  </script>
</body>
</html>
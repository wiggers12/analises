<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - Home</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
  <script type="module" src="firebase.js"></script>
  <style>
    /* ===== SPLASH ===== */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0a0a0f;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 2000;
      animation: fadeIn 1s ease;
    }
    #splash img {
      width: 150px;
      border-radius: 50%;
      margin-bottom: 20px;
    }
    #splash h1 {
      font-size: 1.5rem;
      color: #ff4da6;
      margin-bottom: 10px;
    }
    #splash .progress {
      width: 200px;
      height: 8px;
      background: #333;
      border-radius: 5px;
      overflow: hidden;
    }
    #splash .progress-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff4da6, #8e44ad);
      animation: load 3s forwards;
    }
    @keyframes load { to { width: 100%; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* ===== LAYOUT ===== */
    body { margin:0; background:#0a0a0f; font-family:'Poppins',sans-serif; color:#fff; }
    header.topbar {
      display:flex; justify-content:space-between; align-items:center;
      padding:15px 25px; background:#141422;
    }
    header .logo { display:flex; align-items:center; gap:10px; }
    header .logo img { height:45px; }
    header h1 { font-size:1.5rem; color:#ff4da6; }
    header nav a { color:#fff; margin-left:20px; text-decoration:none; }
    header nav a:hover { color:#ff4da6; }

    .cards-container {
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap:20px;
      padding:20px;
    }
    .card {
      background:#1c1c2b;
      border-radius:12px;
      padding:20px;
      box-shadow:0 4px 15px rgba(0,0,0,0.4);
      transition:0.3s;
    }
    .card:hover { transform:scale(1.02); }
    .card h2 { color:#ff4da6; margin-bottom:15px; }
    .card button {
      margin-top:10px;
      padding:10px 14px;
      border:none;
      border-radius:8px;
      background:linear-gradient(135deg,#ff4da6,#8e44ad);
      color:#fff;
      font-weight:bold;
      cursor:pointer;
      transition:0.3s;
    }
    .card button:hover { transform:scale(1.05); }
    table { width:100%; border-collapse:collapse; }
    table th, table td { padding:6px; border-bottom:1px solid #333; text-align:left; }
    .status-green { color:#2ecc71; }
    .status-red { color:#e74c3c; }
    footer { text-align:center; padding:15px; background:#141422; margin-top:20px; font-size:0.9rem; color:#aaa; }
  </style>
</head>
<body>
  <!-- SPLASH -->
  <div id="splash">
    <img src="img/foto.png" alt="Rainha do Aviator">
    <h1>‚ú® Entradas Inteligentes com a Rainha do Aviator ‚ú®</h1>
    <div class="progress"><div class="progress-bar"></div></div>
  </div>

  <!-- TOPO -->
  <header class="topbar">
    <div class="logo">
      <img src="img/logo.png" alt="GoathBet">
      <h1>GOATH<span>BET</span></h1>
    </div>
    <nav>
      <a href="login.html" id="btnEntrar">Entrar</a>
    </nav>
  </header>

  <!-- CARDS -->
  <section class="cards-container">
    <!-- Gest√£o Financeira -->
    <div class="card">
      <h2>üßÆ Gest√£o Financeira</h2>
      <p>Controle sua banca de forma inteligente.</p>
      <input type="number" id="banca" placeholder="Banca inicial (R$)">
      <input type="number" id="aposta" placeholder="Valor por entrada (R$)">
      <button onclick="salvarGestao()">Salvar Gest√£o</button>
      <p id="gestaoDica"></p>
    </div>

    <!-- Entradas Inteligentes -->
    <div class="card">
      <h2>üéØ Entradas Inteligentes</h2>
      <ul id="listaCalls"></ul>
    </div>

    <!-- Relat√≥rio de Velas -->
    <div class="card">
      <h2>üìà Relat√≥rio de Velas</h2>
      <table>
        <thead><tr><th>Mult</th><th>Hor√°rio</th></tr></thead>
        <tbody id="tabelaVelas"></tbody>
      </table>
    </div>

    <!-- Sorteios -->
    <div class="card">
      <h2>üéÅ Sorteios</h2>
      <ul id="listaSorteios"></ul>
    </div>

    <!-- Planos -->
    <div class="card">
      <h2>üíé Planos</h2>
      <p>Acesse nossos planos exclusivos e desbloqueie o jogo.</p>
      <button onclick="window.location.href='plano.html'">Ver Planos</button>
    </div>

    <!-- Jogar -->
    <div class="card">
      <h2>‚úàÔ∏è Jogar Aviator</h2>
      <p>Entre no jogo e acompanhe os sinais em tempo real.</p>
      <button onclick="acessarJogo()">Entrar no Jogo</button>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>¬© 2025 GoathBet - Todos os direitos reservados.</p>
  </footer>

  <!-- SCRIPT -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { collection, addDoc, doc, setDoc, getDoc, onSnapshot, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Splash desaparece
    setTimeout(()=>document.getElementById("splash").style.display="none",3000);

    // Autentica√ß√£o
    let userId=null;
    onAuthStateChanged(auth,(user)=>{
      if(user){
        userId=user.uid;
        document.getElementById("btnEntrar").innerText="Sair";
        document.getElementById("btnEntrar").onclick=()=>auth.signOut();
      } else {
        userId=null;
        document.getElementById("btnEntrar").innerText="Entrar";
        document.getElementById("btnEntrar").onclick=()=>window.location.href="login.html";
      }
    });

    // ===== Gest√£o =====
    window.salvarGestao=async()=>{
      const banca=parseFloat(document.getElementById("banca").value);
      const aposta=parseFloat(document.getElementById("aposta").value);
      if(!userId) return alert("Fa√ßa login para salvar");
      await addDoc(collection(db,"gestao"),{
        uid:userId, banca, aposta, criadoEm:Timestamp.now()
      });
      document.getElementById("gestaoDica").innerText="üí° Recomenda√ß√£o: apostar "+((aposta/banca)*100).toFixed(2)+"% da banca";
    };

    // ===== Entradas Inteligentes =====
    onSnapshot(collection(db,"callsHistorico"),(snap)=>{
      const ul=document.getElementById("listaCalls");
      ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        ul.innerHTML+=`<li><strong>${hora}</strong> ‚Üí ${d.mult}x <span class="${d.status==='GREEN'?'status-green':'status-red'}">${d.status}</span></li>`;
      });
    });

    // ===== Relat√≥rio de Velas =====
    onSnapshot(collection(db,"velas"),(snap)=>{
      const tb=document.getElementById("tabelaVelas");
      tb.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        tb.innerHTML+=`<tr><td>${d.multiplicador}x</td><td>${hora}</td></tr>`;
      });
    });

    // ===== Sorteios =====
    onSnapshot(collection(db,"sorteios"),(snap)=>{
      const ul=document.getElementById("listaSorteios");
      ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const data=d.data?.toDate?d.data.toDate().toLocaleDateString("pt-BR"):"--/--";
        ul.innerHTML+=`<li>üéÅ ${d.nome} - ${d.premio} (at√© ${data})</li>`;
      });
    });

    // ===== Jogar (checa plano ativo) =====
    window.acessarJogo=async()=>{
      if(!userId) return alert("‚ö†Ô∏è Fa√ßa login primeiro!");
      const ref=doc(db,"assinaturas",userId);
      const snap=await getDoc(ref);
      if(!snap.exists() || snap.data().status!=="ATIVO"){
        alert("‚ö†Ô∏è Voc√™ precisa ter um plano ativo para acessar o jogo!");
        return;
      }
      window.location.href="dashboard.html";
    };
  </script>
</body>
</html>
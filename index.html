<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tay Aviator 100x</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- ===== CABE√áALHO ===== -->
<header class="topbar">
  <div class="logo">GoathBet</div>
  <nav>
    <a href="#" id="linkPlanos">Planos</a>
    <a href="#" id="btnLogin">Login</a>
  </nav>
</header>

<!-- ===== CONTE√öDO ===== -->
<main class="conteudo">

  <!-- HOME -->
  <section id="home" class="secao ativo">
    <img src="img/foto.png" alt="Tay Aviator" class="foto-principal">
    <h1>Tay Aviator 100x</h1>
    <p>Entradas inteligentes com prote√ß√£o e probabilidade real.</p>
  </section>

  <!-- TIP MINER -->
  <section id="calls" class="secao">
    <h2>üìä Hist√≥rico Tip Miner</h2>
    <div id="historicoTip"></div>
  </section>

  <!-- JOGAR -->
  <section id="jogar" class="secao">
    <div class="jogar-fullscreen">
      <button id="voltarMenu"><i class="fas fa-arrow-left"></i> Voltar ao Menu</button>
      <iframe id="iframeJogo" src="https://www.goathbet.com/game/spribe-aviator?r=zktgmbwl" class="jogo-frame"></iframe>
    </div>
  </section>

</main>

<!-- ===== RODAP√â ===== -->
<footer class="footer-bar">
  <a href="#home" id="btnHome" class="ativo"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="#calls" id="btnCalls"><i class="fas fa-signal"></i><span>Tip Miner</span></a>
  <a href="#jogar" id="btnJogar"><i class="fas fa-plane"></i><span>Jogar</span></a>
  <a href="#live"><i class="fas fa-video"></i><span>Live</span></a>
</footer>

<!-- ===== BOT√ÉO FLUTUANTE ===== -->
<button id="btnEntrada"><i class="fas fa-bolt"></i><span id="timerText">--</span></button>

<!-- ===== CARD DE ENTRADA ===== -->
<div id="cardEntrada">
  <h3>Pr√≥xima Entrada</h3>
  <div class="info">
    <p><b>Hor√°rio:</b> <span id="horaEntrada">--:--</span></p>
    <p><b>Prote√ß√£o:</b> <span>2x</span></p>
    <p><b>Probabilidade:</b> <span id="probEntrada">--</span></p>
  </div>
  <div class="faixa-gray">‚è∞ Entrar 30 segundos antes e 30 segundos depois</div>
  <div class="faixa-red">‚ö†Ô∏è Jogue com responsabilidade!</div>
  <button class="fechar-card" onclick="fecharCard()">Fechar</button>
</div>

<!-- ===== MODAL LOGIN / CADASTRO ===== -->
<div id="modalLogin" class="modal">
  <div class="modal-content">
    <span class="fechar" id="fecharLogin">&times;</span>
    <h2 id="tituloLogin">Entrar</h2>

    <div id="areaLogin">
      <input type="email" id="emailLogin" placeholder="E-mail">
      <input type="password" id="senhaLogin" placeholder="Senha">
      <button id="btnEntrar">Acessar</button>
      <p class="trocar" id="linkCadastro">Criar nova conta</p>
    </div>

    <div id="areaCadastro" style="display:none;">
      <input type="text" id="nomeCadastro" placeholder="Nome completo">
      <input type="email" id="emailCadastro" placeholder="E-mail">
      <input type="password" id="senhaCadastro" placeholder="Senha">
      <button id="btnCadastrar">Cadastrar</button>
      <p class="trocar" id="linkLogin">J√° tenho conta</p>
    </div>

    <p class="msg" id="msgLogin"></p>
  </div>
</div>

<!-- ===== SCRIPT PRINCIPAL ===== -->
<script type="module">
import { db, auth } from "./firebase.js";
import { 
  collection, addDoc, onSnapshot, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { 
  signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* ===============================
   NAVEGA√á√ÉO ENTRE SE√á√ïES
=============================== */
const secoes = document.querySelectorAll('.secao');
function mostrarSecao(id) {
  secoes.forEach(s => s.classList.remove('ativo'));
  document.querySelector(id).classList.add('ativo');
}
document.getElementById("btnHome").onclick = () => mostrarSecao("#home");
document.getElementById("btnCalls").onclick = () => mostrarSecao("#calls");
document.getElementById("btnJogar").onclick = () => {
  mostrarSecao("#jogar");
  document.body.requestFullscreen?.();
};
document.getElementById("voltarMenu").onclick = () => {
  document.exitFullscreen?.();
  mostrarSecao("#home");
};

/* ===============================
   TIMER INTELIGENTE ‚Äî PREVIS√ÉO ANTECIPADA
=============================== */
const btnEntrada = document.getElementById("btnEntrada");
const cardEntrada = document.getElementById("cardEntrada");
const probEntrada = document.getElementById("probEntrada");
const horaEntrada = document.getElementById("horaEntrada");
const timerText = document.getElementById("timerText");

const minutosPermitidos = [1,4,7,9,11,14,17,19,21,24,27,29,31,34,37,39,41,44,47,49,51,54,57,59];

// Toggle card
btnEntrada.addEventListener("click", () => cardEntrada.classList.toggle("ativo"));
window.fecharCard = () => cardEntrada.classList.remove("ativo");

// Armazena previs√£o atual e pr√≥xima
let proximoMultiplicador = null;
let minutoPrevisto = null;

function proximoMinutoValido() {
  const agora = new Date();
  const minutoAtual = agora.getMinutes();
  const proximo = minutosPermitidos.find(m => m > minutoAtual);
  return proximo !== undefined ? proximo : minutosPermitidos[0];
}

// Fun√ß√£o principal
function iniciarTimerInteligente() {
  setInterval(async () => {
    const agora = new Date();
    const minutoAtual = agora.getMinutes();
    const segundoAtual = agora.getSeconds();
    const proximo = proximoMinutoValido();

    // segundos at√© o pr√≥ximo minuto permitido
    let diferenca = (proximo - minutoAtual) * 60 - segundoAtual;
    if (diferenca < 0) diferenca += 60 * (60 - minutoAtual + proximo);
    timerText.innerText = `${diferenca}s`;

    // ======== MOSTRAR PREVIS√ÉO 30s ANTES ========
    if (diferenca === 30 && !proximoMultiplicador) {
      proximoMultiplicador = parseFloat((Math.random() * 99 + 1).toFixed(2));
      minutoPrevisto = proximo;

      const hora = String(agora.getHours()).padStart(2, "0");
      horaEntrada.innerText = `${hora}:${String(proximo).padStart(2, "0")}`;
      probEntrada.innerText = `${proximoMultiplicador}x`;
      btnEntrada.classList.add("alerta"); // muda cor para chamar aten√ß√£o
    }

    // ======== QUANDO CHEGAR NO HOR√ÅRIO PREVISTO ========
    if (minutosPermitidos.includes(minutoAtual) && segundoAtual === 0 && proximoMultiplicador) {
      const hora = String(agora.getHours()).padStart(2, "0");
      await addDoc(collection(db, "tipminer"), {
        multiplicador: proximoMultiplicador,
        hora,
        minuto: minutoPrevisto,
        criadoEm: serverTimestamp()
      });
      btnEntrada.classList.remove("alerta");
      proximoMultiplicador = null;
    }

    // ======== EFEITO VISUAL DE ALERTA ========
    if (diferenca <= 5) btnEntrada.classList.add("alerta");
    else if (diferenca > 5 && !proximoMultiplicador) btnEntrada.classList.remove("alerta");
  }, 1000);
}

iniciarTimerInteligente();

/* ===============================
   HIST√ìRICO ‚Äî TIPMINER GRID
=============================== */
const historicoTip = document.getElementById("historicoTip");
onSnapshot(collection(db, "tipminer"), (snapshot) => {
  let html = "";
  const docs = snapshot.docs
    .sort((a, b) => b.data().criadoEm?.seconds - a.data().criadoEm?.seconds)
    .slice(0, 25);
  docs.forEach(doc => {
    const d = doc.data();
    const cor = d.multiplicador < 2 ? "cinza" : d.multiplicador < 10 ? "verde" : "ouro";
    html += `
      <div class="card-historico ${cor}">
        <b>${d.multiplicador}x</b>
        <small>${d.hora}:${d.minuto}</small>
      </div>`;
  });
  historicoTip.innerHTML = html;
});

/* ===============================
   LOGIN / CADASTRO MODAL
=============================== */
const modal = document.getElementById("modalLogin");
const btnLogin = document.getElementById("btnLogin");
const fechar = document.getElementById("fecharLogin");
const areaLogin = document.getElementById("areaLogin");
const areaCadastro = document.getElementById("areaCadastro");
const titulo = document.getElementById("tituloLogin");
const msg = document.getElementById("msgLogin");

// Abrir e fechar modal
btnLogin.addEventListener("click", () => {
  modal.classList.add("ativo");
  mostrarLogin();
});
fechar.addEventListener("click", () => modal.classList.remove("ativo"));
window.addEventListener("click", e => { if (e.target === modal) modal.classList.remove("ativo"); });

document.getElementById("linkCadastro").onclick = () => mostrarCadastro();
document.getElementById("linkLogin").onclick = () => mostrarLogin();

function mostrarCadastro() {
  areaLogin.style.display = "none";
  areaCadastro.style.display = "block";
  titulo.innerText = "Criar Conta";
  msg.innerText = "";
}
function mostrarLogin() {
  areaLogin.style.display = "block";
  areaCadastro.style.display = "none";
  titulo.innerText = "Entrar";
  msg.innerText = "";
}

// Login
document.getElementById("btnEntrar").addEventListener("click", async () => {
  const email = document.getElementById("emailLogin").value.trim();
  const senha = document.getElementById("senhaLogin").value.trim();
  if (!email || !senha) return msg.innerText = "Preencha todos os campos.";
  try {
    await signInWithEmailAndPassword(auth, email, senha);
    msg.innerText = "‚úÖ Login realizado com sucesso!";
    msg.style.color = "#4caf50";
    setTimeout(() => modal.classList.remove("ativo"), 1500);
  } catch {
    msg.innerText = "‚ùå E-mail ou senha incorretos.";
    msg.style.color = "#ff4d4d";
  }
});

// Cadastro
document.getElementById("btnCadastrar").addEventListener("click", async () => {
  const nome = document.getElementById("nomeCadastro").value.trim();
  const email = document.getElementById("emailCadastro").value.trim();
  const senha = document.getElementById("senhaCadastro").value.trim();
  if (!nome || !email || !senha) return msg.innerText = "Preencha todos os campos.";
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    await updateProfile(userCredential.user, { displayName: nome });
    msg.innerText = "‚úÖ Conta criada com sucesso!";
    msg.style.color = "#4caf50";
    setTimeout(() => mostrarLogin(), 1500);
  } catch (error) {
    msg.innerText = "‚ùå Erro: " + error.message;
    msg.style.color = "#ff4d4d";
  }
});

// Persist√™ncia autom√°tica do login
onAuthStateChanged(auth, (user) => {
  if (user) btnLogin.innerText = user.displayName || "Perfil";
});
</script>

</body>
</html>
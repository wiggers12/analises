<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - Início</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
  <style>
    /* SPLASH */
    #splash {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #0a0a0f;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 3000;
    }
    #splash img {
      width: 120px;
      margin-bottom: 20px;
      animation: pulse 1.8s infinite;
    }
    #splash h2 {
      color: #ff4da6;
      font-size: 1.3rem;
      margin: 0;
    }
    @keyframes pulse {
      0% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 0.8; }
    }

    /* CARDS */
    .hub-modulos {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 30px 0;
    }
    .hub-card {
      background: linear-gradient(135deg, #2a003f, #ff4da6);
      border-radius: 14px;
      padding: 20px;
      width: 220px;
      text-align: center;
      color: #fff;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: transform 0.3s;
    }
    .hub-card:hover { transform: translateY(-6px); }
    .hub-card h3 { margin-top: 10px; font-size: 1.2rem; color: #fff; }

    /* MODAIS */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .card-box {
      background: #1c1c2b;
      padding: 25px;
      border-radius: 12px;
      max-width: 600px;
      width: 90%;
      color: #fff;
    }
    .fechar {
      float: right;
      font-size: 28px;
      cursor: pointer;
      color: #fff;
    }

    footer { text-align: center; padding: 20px; color: #aaa; }
  </style>
</head>
<body>
  <!-- SPLASH -->
  <div id="splash">
    <img src="img/foto.png" alt="GoathBet">
    <h2>Entradas Inteligentes com a Rainha do Aviator</h2>
  </div>

  <!-- TOPO -->
  <header class="topbar">
    <div class="logo">
      <img src="img/logo.png" alt="GoathBet" height="45">
      <h1>GOATH<span>BET</span></h1>
    </div>
    <nav>
      <a href="index.html" class="ativo">Início</a>
      <a href="login.html" class="btn-login" id="btnEntrar">Entrar</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h2>💖 Bem-vinda ao <span>GoathBet</span></h2>
    <p>Os melhores sinais, relatórios e gestão para turbinar sua banca.</p>
  </section>

  <!-- HUB DE CARDS -->
  <section class="hub-modulos">
    <div class="hub-card" onclick="abrirModal('gestao')">
      🧮 <h3>Gestão Financeira</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('velas')">
      📊 <h3>Relatórios de Velas</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('sinais')">
      🎯 <h3>Sinais de Entrada</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('sorteios')">
      🎁 <h3>Sorteios</h3>
    </div>
    <div class="hub-card" onclick="window.location.href='plano.html'">
      💎 <h3>Planos</h3>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>© 2025 GoathBet - Todos os direitos reservados | Feito com 💜</p>
  </footer>

  <!-- MODAIS -->
  <!-- Gestão -->
  <div id="modal-gestao" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('gestao')">×</span>
      <h2>🧮 Gestão Financeira</h2>
      <p>Preencha os valores para controlar sua banca:</p>
      <input type="number" id="bancaInicial" placeholder="Banca inicial (R$)">
      <input type="number" id="valorEntrada" placeholder="Valor por entrada (R$)">
      <p id="resultadoGestao"></p>
      <button onclick="calcularGestao()">Calcular</button>
    </div>
  </div>

  <!-- Velas -->
  <div id="modal-velas" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('velas')">×</span>
      <h2>📊 Últimas Velas</h2>
      <div id="gridVelas"></div>
    </div>
  </div>

  <!-- Sinais -->
  <div id="modal-sinais" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sinais')">×</span>
      <h2>🎯 Sinais de Entrada</h2>
      <ul id="listaSinais"></ul>
    </div>
  </div>

  <!-- Sorteios -->
  <div id="modal-sorteios" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sorteios')">×</span>
      <h2>🎁 Sorteios Ativos</h2>
      <ul id="listaSorteios"></ul>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const btnEntrar = document.getElementById("btnEntrar");

    // 🔑 Splash
    window.addEventListener("load", () => {
      setTimeout(()=>{ document.getElementById("splash").style.display="none"; }, 2500);
    });

    // 🔑 Autenticação + Plano
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const ref = doc(db, "assinaturas", user.uid);
        const snap = await getDoc(ref);
        if (snap.exists() && snap.data().status === "ATIVO") {
          window.location.href = "dashboard.html"; // joga direto pro jogo
        } else {
          // mostra plano
          console.log("Sem plano ativo, redirecionar plano.html");
        }
      } else {
        if (btnEntrar) btnEntrar.style.display = "inline-block";
      }
    });

    // ⚡ Modais
    window.abrirModal = (id)=>document.getElementById("modal-"+id).style.display="flex";
    window.fecharModal = (id)=>document.getElementById("modal-"+id).style.display="none";

    // Gestão financeira simples
    window.calcularGestao = () => {
      const banca = parseFloat(document.getElementById("bancaInicial").value)||0;
      const entrada = parseFloat(document.getElementById("valorEntrada").value)||0;
      if (banca>0 && entrada>0){
        document.getElementById("resultadoGestao").innerText = 
          `Você pode fazer ${Math.floor(banca/entrada)} entradas de R$${entrada.toFixed(2)}.`;
      }
    };

    // Velas em tempo real
    onSnapshot(collection(db,"velas"),(snap)=>{
      const grid=document.getElementById("gridVelas"); grid.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        grid.innerHTML+=`<div>${d.multiplicador}x <small>${hora}</small></div>`;
      });
    });

    // Sinais em tempo real
    onSnapshot(collection(db,"callsHistorico"),(snap)=>{
      const ul=document.getElementById("listaSinais"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        ul.innerHTML+=`<li>${hora} → ${d.mult}x <span style="color:${d.status==='GREEN'?'#2ecc71':'#e74c3c'}">${d.status}</span></li>`;
      });
    });

    // Sorteios em tempo real
    onSnapshot(collection(db,"sorteios"),(snap)=>{
      const ul=document.getElementById("listaSorteios"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        ul.innerHTML+=`<li>${d.nome} - ${d.status}</li>`;
      });
    });
  </script>
</body>
</html>
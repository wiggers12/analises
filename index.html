<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - Início</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
  <script type="module" src="firebase.js"></script>
  <style>
    /* ===== Splash ===== */
    #splash {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: linear-gradient(135deg, #1a0f1f, #2a0939);
      color: #fff;
      text-align: center;
    }
    #splash img {
      width: 180px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    #splash h1 { color: #ff4da6; margin-bottom: 10px; }
    #splash p { color: #f8bbd0; }

    /* ===== Home ===== */
    #home {
      display: none;
      padding: 30px;
      text-align: center;
    }
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }
    .btn-card {
      background: linear-gradient(135deg, #ff4da6, #8e44ad);
      color: #fff;
      border-radius: 16px;
      padding: 25px 15px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      transition: 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .btn-card:hover { transform: scale(1.08); }
    .btn-card span {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    /* ===== Modal ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .modal-content {
      background: #1c1c2b;
      padding: 25px;
      border-radius: 12px;
      max-width: 800px;
      width: 95%;
      color: #fff;
      overflow-y: auto;
      max-height: 90vh;
    }
    .modal .fechar {
      float: right;
      font-size: 26px;
      cursor: pointer;
      color: #fff;
    }

    /* ===== Planilha ===== */
    table.planilha {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    .planilha th, .planilha td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    .planilha input {
      width: 100%;
      padding: 6px;
      text-align: center;
      background: #2a0939;
      border: none;
      color: #fff;
    }

    /* ===== Botão Login ===== */
    .btn-login-bottom {
      display: inline-block;
      margin: 40px auto 0;
      padding: 14px 28px;
      background: linear-gradient(135deg, #27ae60, #2ecc71);
      color: #fff;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 12px;
      text-decoration: none;
      transition: 0.3s;
    }
    .btn-login-bottom:hover {
      background: linear-gradient(135deg, #219150, #27ae60);
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <!-- ===== Splash ===== -->
  <div id="splash">
    <img src="img/foto.png" alt="GoathBet">
    <h1>GoathBet</h1>
    <p>✨ Entradas Inteligentes com a Rainha do Aviator ✨</p>
  </div>

  <!-- ===== Home ===== -->
  <div id="home">
    <h2>📌 Menu Principal</h2>
    <div class="menu-grid">
      <div class="btn-card" onclick="abrirModal('gestao')"><span>🧮</span> Gestão</div>
      <div class="btn-card" onclick="abrirModal('entradas')"><span>🎯</span> Entradas</div>
      <div class="btn-card" onclick="abrirModal('velas')"><span>📈</span> Velas</div>
      <div class="btn-card" onclick="abrirModal('sorteios')"><span>🎁</span> Sorteios</div>
      <div class="btn-card" onclick="abrirModal('planos')"><span>💳</span> Planos</div>
      <div class="btn-card" onclick="abrirJogo()"><span>🎮</span> Jogar</div>
    </div>

    <!-- Botão Login -->
    <a href="login.html" class="btn-login-bottom">🚀 Fazer Login</a>
  </div>

  <!-- ===== Modais ===== -->

  <!-- Gestão -->
  <div id="modal-gestao" class="modal">
    <div class="modal-content">
      <span class="fechar" onclick="fecharModal('gestao')">&times;</span>
      <h2>🧮 Gestão Financeira</h2>
      <table class="planilha">
        <tr><th>Banca Inicial</th><td><input id="bancaInicial" type="number" placeholder="1000"></td></tr>
        <tr><th>Entrada</th><td><input id="valorEntrada" type="number" placeholder="10"></td></tr>
        <tr><th>Ganhos</th><td><input id="ganhos" type="number" placeholder="0"></td></tr>
        <tr><th>Perdas</th><td><input id="perdas" type="number" placeholder="0"></td></tr>
        <tr><th>Lucro</th><td><span id="lucro">0</span></td></tr>
        <tr><th>Saldo Atual</th><td><span id="saldo">0</span></td></tr>
      </table>
    </div>
  </div>

  <!-- Entradas -->
  <div id="modal-entradas" class="modal">
    <div class="modal-content">
      <span class="fechar" onclick="fecharModal('entradas')">&times;</span>
      <h2>🎯 Últimos Calls</h2>
      <ul id="listaEntradas"></ul>
    </div>
  </div>

  <!-- Velas -->
  <div id="modal-velas" class="modal">
    <div class="modal-content">
      <span class="fechar" onclick="fecharModal('velas')">&times;</span>
      <h2>📈 Relatório de Velas</h2>
      <div id="listaVelas"></div>
    </div>
  </div>

  <!-- Sorteios -->
  <div id="modal-sorteios" class="modal">
    <div class="modal-content">
      <span class="fechar" onclick="fecharModal('sorteios')">&times;</span>
      <h2>🎁 Sorteios</h2>
      <div id="listaSorteios"></div>
    </div>
  </div>

  <!-- Planos -->
  <div id="modal-planos" class="modal">
    <div class="modal-content">
      <span class="fechar" onclick="fecharModal('planos')">&times;</span>
      <h2>💳 Nossos Planos</h2>
      <p><a href="planos.html" class="btn-card">👉 Ver Planos</a></p>
    </div>
  </div>

  <!-- ===== Script ===== -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { getDoc, doc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Splash → Home
    setTimeout(()=>{ 
      document.getElementById("splash").style.display="none"; 
      document.getElementById("home").style.display="block"; 
    }, 2500);

    // Funções de modal
    window.abrirModal=(id)=>document.getElementById("modal-"+id).style.display="flex";
    window.fecharModal=(id)=>document.getElementById("modal-"+id).style.display="none";

    // Gestão financeira (planilha dinâmica)
    const inputs=["bancaInicial","valorEntrada","ganhos","perdas"];
    inputs.forEach(id=>{
      document.getElementById(id).addEventListener("input",calcularGestao);
    });
    function calcularGestao(){
      const banca=parseFloat(document.getElementById("bancaInicial").value)||0;
      const entrada=parseFloat(document.getElementById("valorEntrada").value)||0;
      const ganhos=parseFloat(document.getElementById("ganhos").value)||0;
      const perdas=parseFloat(document.getElementById("perdas").value)||0;
      const lucro=ganhos-perdas;
      const saldo=banca+lucro-entrada;
      document.getElementById("lucro").innerText=lucro.toFixed(2);
      document.getElementById("saldo").innerText=saldo.toFixed(2);
    }

    // Entradas
    onSnapshot(collection(db,"callsHistorico"),(snap)=>{
      let html="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        html+=`<li>${hora} → ${d.mult}x (${d.status})</li>`;
      });
      document.getElementById("listaEntradas").innerHTML=html;
    });

    // Velas
    onSnapshot(collection(db,"velas"),(snap)=>{
      let html="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        html+=`<div>${d.multiplicador}x - ${hora}</div>`;
      });
      document.getElementById("listaVelas").innerHTML=html;
    });

    // Sorteios
    onSnapshot(collection(db,"sorteios"),(snap)=>{
      let html="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        html+=`<div>🎁 ${d.nome} - prêmio ${d.premio}</div>`;
      });
      document.getElementById("listaSorteios").innerHTML=html;
    });

    // Jogar (verifica assinatura)
    window.abrirJogo=async()=>{
      const user=auth.currentUser;
      if(!user){ alert("Faça login primeiro!"); return; }
      const ref=doc(db,"assinaturas",user.uid);
      const snap=await getDoc(ref);
      if(!snap.exists() || snap.data().status!=="ATIVO"){
        alert("Plano inativo. Assine primeiro!");
        return;
      }
      window.location.href="dashboard.html";
    };
  </script>
</body>
</html>
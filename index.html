<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tay Aviator 100x</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- ===== CABE√áALHO ===== -->
<header class="topbar">
  <div class="logo">GoathBet</div>
  <nav>
    <a href="#" id="linkPlanos">Planos</a>
    <a href="#" id="btnLogin">Login</a>
  </nav>
</header>

<!-- ===== CONTE√öDO ===== -->
<main class="conteudo">

  <!-- HOME -->
  <section id="home" class="secao ativo">
    <img src="img/foto.png" alt="Tay Aviator" class="foto-principal">
    <h1>Tay Aviator 100x</h1>
    <p>Entradas inteligentes com prote√ß√£o e probabilidade real.</p>
  </section>

  <!-- TIP MINER -->
  <section id="calls" class="secao">
    <h2>üìä Hist√≥rico Tip Miner</h2>
    <div id="historicoTip"></div>
  </section>

  <!-- JOGAR -->
  <section id="jogar" class="secao">
    <div class="jogar-fullscreen">
      <button id="voltarMenu"><i class="fas fa-arrow-left"></i> Voltar ao Menu</button>
      <iframe id="iframeJogo" src="https://www.goathbet.com/game/spribe-aviator?r=zktgmbwl" class="jogo-frame"></iframe>
    </div>
  </section>

</main>

<!-- ===== RODAP√â ===== -->
<footer class="footer-bar">
  <a href="#home" id="btnHome" class="ativo"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="#calls" id="btnCalls"><i class="fas fa-signal"></i><span>Tip Miner</span></a>
  <a href="#jogar" id="btnJogar"><i class="fas fa-plane"></i><span>Jogar</span></a>
  <a href="#live"><i class="fas fa-video"></i><span>Live</span></a>
</footer>

<!-- ===== BOT√ÉO FLUTUANTE TIMER ===== -->
<button id="btnEntrada"><i class="fas fa-bolt"></i><span id="timerText">--</span></button>

<!-- ===== BOT√ÉO FLUTUANTE DICAS ===== -->
<button id="btnDicas"><i class="fas fa-lightbulb"></i></button>

<!-- ===== CARD DE ENTRADA ===== -->
<div id="cardEntrada">
  <h3>Pr√≥xima Entrada</h3>
  <div class="info">
    <p><b>Hor√°rio:</b> <span id="horaEntrada">--:--</span></p>
    <p><b>Prote√ß√£o:</b> <span>2x</span></p>
    <p><b>Probabilidade:</b> <span id="probEntrada">--</span></p>
  </div>
  <div class="faixa-gray">‚è∞ Entrar 30 segundos antes e 30 segundos depois</div>
  <div class="faixa-red">‚ö†Ô∏è Jogue com responsabilidade!</div>
  <button class="fechar-card" onclick="fecharCard()">Fechar</button>
</div>

<!-- ===== CARD DE DICAS ===== -->
<div id="cardDicas">
  <h3>Dica Inteligente</h3>
  <p>Quantas velas <b>azuis</b> seguidas sa√≠ram?</p>
  <input type="number" id="inputAzuis" min="1" max="9" placeholder="Ex: 3" />
  <button id="btnCalcularDica">Calcular</button>
  <div id="resultadoDica"></div>
  <button class="fechar-card" onclick="fecharDica()">Fechar</button>
</div>

<!-- ===== MODAL LOGIN / CADASTRO ===== -->
<div id="modalLogin" class="modal">
  <div class="modal-content">
    <span class="fechar" id="fecharLogin">&times;</span>
    <h2 id="tituloLogin">Entrar</h2>

    <div id="areaLogin">
      <input type="email" id="emailLogin" placeholder="E-mail">
      <input type="password" id="senhaLogin" placeholder="Senha">
      <button id="btnEntrar">Acessar</button>
      <p class="trocar" id="linkCadastro">Criar nova conta</p>
    </div>

    <div id="areaCadastro" style="display:none;">
      <input type="text" id="nomeCadastro" placeholder="Nome completo">
      <input type="email" id="emailCadastro" placeholder="E-mail">
      <input type="password" id="senhaCadastro" placeholder="Senha">
      <button id="btnCadastrar">Cadastrar</button>
      <p class="trocar" id="linkLogin">J√° tenho conta</p>
    </div>

    <p class="msg" id="msgLogin"></p>
  </div>
</div>

<!-- ===== SCRIPT PRINCIPAL ===== -->
<script type="module">
import { db, auth } from "./firebase.js";
import { 
  collection, addDoc, onSnapshot, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { 
  signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* ===============================
   NAVEGA√á√ÉO ENTRE SE√á√ïES
=============================== */
const secoes = document.querySelectorAll('.secao');
function mostrarSecao(id) {
  secoes.forEach(s => s.classList.remove('ativo'));
  document.querySelector(id).classList.add('ativo');
}
document.getElementById("btnHome").onclick = () => mostrarSecao("#home");
document.getElementById("btnCalls").onclick = () => mostrarSecao("#calls");
document.getElementById("btnJogar").onclick = () => {
  mostrarSecao("#jogar");
  document.body.requestFullscreen?.();
};
document.getElementById("voltarMenu").onclick = () => {
  document.exitFullscreen?.();
  mostrarSecao("#home");
};

/* ===============================
   TIMER INTELIGENTE ‚Äî FINAL FUNCIONAL
=============================== */
const btnEntrada = document.getElementById("btnEntrada");
const cardEntrada = document.getElementById("cardEntrada");
const probEntrada = document.getElementById("probEntrada");
const horaEntrada = document.getElementById("horaEntrada");
const timerText = document.getElementById("timerText");

const minutosPermitidos = [1,4,7,9,11,14,17,19,21,24,27,29,31,34,37,39,41,44,47,49,51,54,57,59];
let previsaoFeita = false;
let proximoMultiplicador = null;

btnEntrada.addEventListener("click", () => cardEntrada.classList.toggle("ativo"));
window.fecharCard = () => cardEntrada.classList.remove("ativo");

function proximoMinutoValido() {
  const agora = new Date();
  const minutoAtual = agora.getMinutes();
  const futuro = minutosPermitidos.find(m => m > minutoAtual);
  return futuro !== undefined ? futuro : minutosPermitidos[0];
}

function atualizarTimer() {
  const agora = new Date();
  const minutoAtual = agora.getMinutes();
  const segundoAtual = agora.getSeconds();
  const proximo = proximoMinutoValido();

  let diferenca;
  if (minutoAtual >= minutosPermitidos[minutosPermitidos.length - 1]) {
    diferenca = ((60 - minutoAtual + minutosPermitidos[0]) * 60) - segundoAtual;
  } else {
    diferenca = ((proximo - minutoAtual) * 60) - segundoAtual;
  }

  timerText.innerText = `${diferenca}s`;

  if (diferenca <= 30 && !previsaoFeita) {
    const hora = String(agora.getHours()).padStart(2, "0");
    const minutoFmt = String(proximo).padStart(2, "0");
    horaEntrada.innerText = `${hora}:${minutoFmt}`;
    proximoMultiplicador = parseFloat((Math.random() * 99 + 1).toFixed(2));
    probEntrada.innerText = `${proximoMultiplicador}x`;
    btnEntrada.classList.add("alerta");
    previsaoFeita = true;
  }

  if (diferenca <= 5) btnEntrada.classList.add("alerta");
  else if (diferenca > 5 && previsaoFeita) btnEntrada.classList.remove("alerta");

  if (diferenca <= 0 && previsaoFeita && proximoMultiplicador !== null) {
    const hora = String(agora.getHours()).padStart(2, "0");
    addDoc(collection(db, "tipminer"), {
      multiplicador: proximoMultiplicador,
      hora,
      minuto: String(proximo).padStart(2, "0"),
      criadoEm: serverTimestamp()
    });
    previsaoFeita = false;
    proximoMultiplicador = null;
    btnEntrada.classList.remove("alerta");
  }
}
setInterval(atualizarTimer, 1000);

/* ===============================
   SISTEMA DE DICAS INTELIGENTES
=============================== */
const btnDicas = document.getElementById("btnDicas");
const cardDicas = document.getElementById("cardDicas");
const inputAzuis = document.getElementById("inputAzuis");
const btnCalcularDica = document.getElementById("btnCalcularDica");
const resultadoDica = document.getElementById("resultadoDica");

btnDicas.addEventListener("click", () => cardDicas.classList.toggle("ativo"));
window.fecharDica = () => cardDicas.classList.remove("ativo");

btnCalcularDica.addEventListener("click", () => {
  const n = parseInt(inputAzuis.value);
  if (isNaN(n) || n < 1) {
    resultadoDica.textContent = "Informe um n√∫mero v√°lido.";
    resultadoDica.className = "";
    return;
  }

  let prob = 0;
  let mensagem = "";

  if (n >= 7 && n <= 9) {
    prob = 95;
    mensagem = "üî• Alta probabilidade de vela ROXA ou ROSA!";
    resultadoDica.className = "alta";
  } else if (n >= 5) {
    prob = 80;
    mensagem = "üí• Grande chance de vela ROXA ou ROSA!";
    resultadoDica.className = "alta";
  } else if (n >= 3) {
    prob = 70;
    mensagem = "‚ö° Boa chance de vela ROXA!";
    resultadoDica.className = "media";
  } else {
    prob = 0;
    mensagem = "üìâ Probabilidade baixa de vela roxa.";
    resultadoDica.className = "";
  }

  resultadoDica.textContent = `${mensagem} (${prob}%)`;
});

/* ===============================
   HIST√ìRICO ‚Äî TIPMINER GRID
=============================== */
const historicoTip = document.getElementById("historicoTip");
onSnapshot(collection(db, "tipminer"), (snapshot) => {
  let html = "";
  const docs = snapshot.docs
    .sort((a, b) => b.data().criadoEm?.seconds - a.data().criadoEm?.seconds)
    .slice(0, 25);
  docs.forEach(doc => {
    const d = doc.data();
    const cor = d.multiplicador < 2 ? "cinza" : d.multiplicador < 10 ? "verde" : "ouro";
    html += `<div class="card-historico ${cor}"><b>${d.multiplicador}x</b><small>${d.hora}:${d.minuto}</small></div>`;
  });
  historicoTip.innerHTML = html;
});

/* ===============================
   LOGIN / CADASTRO MODAL
=============================== */
const modal = document.getElementById("modalLogin");
const btnLogin = document.getElementById("btnLogin");
const fechar = document.getElementById("fecharLogin");
const areaLogin = document.getElementById("areaLogin");
const areaCadastro = document.getElementById("areaCadastro");
const titulo = document.getElementById("tituloLogin");
const msg = document.getElementById("msgLogin");

btnLogin.addEventListener("click", () => { modal.classList.add("ativo"); mostrarLogin(); });
fechar.addEventListener("click", () => modal.classList.remove("ativo"));
window.addEventListener("click", e => { if (e.target === modal) modal.classList.remove("ativo"); });

document.getElementById("linkCadastro").onclick = () => mostrarCadastro();
document.getElementById("linkLogin").onclick = () => mostrarLogin();

function mostrarCadastro() {
  areaLogin.style.display = "none";
  areaCadastro.style.display = "block";
  titulo.innerText = "Criar Conta";
  msg.innerText = "";
}
function mostrarLogin() {
  areaLogin.style.display = "block";
  areaCadastro.style.display = "none";
  titulo.innerText = "Entrar";
  msg.innerText = "";
}

document.getElementById("btnEntrar").addEventListener("click", async () => {
  const email = document.getElementById("emailLogin").value.trim();
  const senha = document.getElementById("senhaLogin").value.trim();
  if (!email || !senha) return msg.innerText = "Preencha todos os campos.";
  try {
    await signInWithEmailAndPassword(auth, email, senha);
    msg.innerText = "‚úÖ Login realizado com sucesso!";
    msg.style.color = "#4caf50";
    setTimeout(() => modal.classList.remove("ativo"), 1500);
  } catch {
    msg.innerText = "‚ùå E-mail ou senha incorretos.";
    msg.style.color = "#ff4d4d";
  }
});

document.getElementById("btnCadastrar").addEventListener("click", async () => {
  const nome = document.getElementById("nomeCadastro").value.trim();
  const email = document.getElementById("emailCadastro").value.trim();
  const senha = document.getElementById("senhaCadastro").value.trim();
  if (!nome || !email || !senha) return msg.innerText = "Preencha todos os campos.";
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
    await updateProfile(userCredential.user, { displayName: nome });
    msg.innerText = "‚úÖ Conta criada com sucesso!";
    msg.style.color = "#4caf50";
    setTimeout(() => mostrarLogin(), 1500);
  } catch (error) {
    msg.innerText = "‚ùå Erro: " + error.message;
    msg.style.color = "#ff4d4d";
  }
});

onAuthStateChanged(auth, (user) => { if (user) btnLogin.innerText = user.displayName || "Perfil"; });
</script>

</body>
</html>
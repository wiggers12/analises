<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tay Aviator 100x</title>
<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<!-- ===== CABE√áALHO ===== -->
<header class="topbar">
  <div class="logo">GoathBet</div>
  <nav>
    <a href="#" id="linkPlanos">Planos</a>
    <a href="#" id="btnLogin">Login</a>
  </nav>
</header>

<!-- ===== CONTE√öDO ===== -->
<main class="conteudo">

  <!-- HOME -->
  <section id="home" class="secao ativo">
    <img src="img/foto.png" alt="Tay Aviator" class="foto-principal">
    <h1>Tay Aviator 100x</h1>
    <p>Entradas inteligentes com prote√ß√£o e probabilidade real.</p>
  </section>

  <!-- TIP MINER -->
  <section id="calls" class="secao">
    <div class="calls-box">
      <h2>üìä Hist√≥rico Tip Miner</h2>
      <div id="historicoTip"></div>
    </div>
  </section>

  <!-- JOGAR -->
  <section id="jogar" class="secao">
    <div class="jogar-fullscreen">
      <button id="voltarMenu"><i class="fas fa-arrow-left"></i> Voltar ao Menu</button>
      <iframe id="iframeJogo" src="https://www.goathbet.com/game/spribe-aviator?r=zktgmbwl" class="jogo-frame"></iframe>
    </div>
  </section>

</main>

<!-- ===== RODAP√â ===== -->
<footer class="footer-bar">
  <a href="#home" id="btnHome" class="ativo"><i class="fas fa-home"></i><span>Home</span></a>
  <a href="#calls" id="btnCalls"><i class="fas fa-signal"></i><span>Tip Miner</span></a>
  <a href="#jogar" id="btnJogar"><i class="fas fa-plane"></i><span>Jogar</span></a>
  <a href="#live"><i class="fas fa-video"></i><span>Live</span></a>
</footer>

<!-- ===== BOT√ÉO FLUTUANTE UNIFICADO ===== -->
<div id="btnEntrada" class="btn-expandido">
  <div class="botao-topo">
    <i class="fas fa-bolt"></i> <span id="timerText">60s</span>
  </div>
  <div class="info-oculta">
    <p><b>Hor√°rio:</b> <span id="horaEntrada">--:--</span></p>
    <p><b>Prote√ß√£o:</b> <span>2x</span></p>
    <p><b>Probabilidade:</b> <span id="probEntrada">--</span></p>
    <div class="faixa-gray">‚è∞ Entrar 30 segundos antes e 30 depois</div>
    <div class="faixa-red">‚ö†Ô∏è Jogue com responsabilidade!</div>
  </div>
</div>

<!-- ===== SCRIPT PRINCIPAL ===== -->
<script type="module">
import { db } from "./firebase.js";
import { collection, addDoc, onSnapshot, serverTimestamp } 
  from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

/* ===============================
   NAVEGA√á√ÉO ENTRE SE√á√ïES
=============================== */
const secoes = document.querySelectorAll('.secao');
function mostrarSecao(id) {
  secoes.forEach(s => s.classList.remove('ativo'));
  document.querySelector(id).classList.add('ativo');
}

document.getElementById("btnHome").onclick = () => mostrarSecao("#home");
document.getElementById("btnCalls").onclick = () => mostrarSecao("#calls");
document.getElementById("btnJogar").onclick = () => {
  mostrarSecao("#jogar");
  document.body.requestFullscreen?.();
};

document.getElementById("voltarMenu").onclick = () => {
  document.exitFullscreen?.();
  mostrarSecao("#home");
};

/* ===============================
   TIMER PERSISTENTE + FIRESTORE
=============================== */
const btnEntrada = document.getElementById("btnEntrada");
const probEntrada = document.getElementById("probEntrada");
const horaEntrada = document.getElementById("horaEntrada");
const timerText = document.getElementById("timerText");

btnEntrada.addEventListener("click", () => {
  btnEntrada.classList.toggle("ativo");
});

let tempoTotal = 60;
let intervalo = null;

function getTempoRestante() {
  const inicioSalvo = localStorage.getItem("inicioTimer");
  if (!inicioSalvo) {
    localStorage.setItem("inicioTimer", Date.now().toString());
    return tempoTotal;
  }
  const diff = Math.floor((Date.now() - parseInt(inicioSalvo)) / 1000);
  const restante = tempoTotal - diff;
  return restante > 0 ? restante : 0;
}

function atualizarUI(tempo) {
  timerText.innerText = tempo + "s";
}

async function iniciarTimer() {
  let tempo = getTempoRestante();
  atualizarUI(tempo);

  if (intervalo) clearInterval(intervalo);
  intervalo = setInterval(async () => {
    tempo--;
    atualizarUI(tempo);

    if (tempo <= 0) {
      clearInterval(intervalo);
      const multiplicador = parseFloat((Math.random() * 99 + 1).toFixed(2));
      const agora = new Date();
      const hora = String(agora.getHours()).padStart(2, "0");
      const minuto = String(agora.getMinutes()).padStart(2, "0");

      horaEntrada.innerText = `${hora}:${minuto}`;
      probEntrada.innerText = `${multiplicador}x`;

      await addDoc(collection(db, "tipminer"), {
        multiplicador,
        hora,
        minuto,
        criadoEm: serverTimestamp()
      });

      localStorage.setItem("inicioTimer", Date.now().toString());
      iniciarTimer();
    }
  }, 1000);
}

if (!localStorage.getItem("inicioTimer")) {
  localStorage.setItem("inicioTimer", Date.now().toString());
}
iniciarTimer();

/* ===============================
   HIST√ìRICO AO VIVO (TIP MINER)
=============================== */
const historicoTip = document.getElementById("historicoTip");

onSnapshot(collection(db, "tipminer"), (snapshot) => {
  let html = "";
  const docs = snapshot.docs
    .sort((a, b) => b.data().criadoEm?.seconds - a.data().criadoEm?.seconds)
    .slice(0, 20);
  
  docs.forEach(doc => {
    const d = doc.data();
    html += `
      <div class="card-historico ${
        d.multiplicador < 2 ? "azul" :
        d.multiplicador < 10 ? "roxo" : "rosa"
      }">
        <b>${d.multiplicador}x</b><br>
        <small>${d.hora}:${d.minuto}</small>
      </div>`;
  });
  historicoTip.innerHTML = `<div id="grade-historico-premium">${html}</div>`;
});
</script>

</body>
</html>
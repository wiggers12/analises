<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GoathBet - Início</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="img/logo.png" type="image/png">
</head>
<body>
  <!-- SPLASH -->
  <div id="splash" class="splash">
    <img src="img/foto.png" alt="GoathBet">
    <h1>Entradas Inteligentes</h1>
    <p>com a Rainha do Aviator</p>
  </div>

  <!-- HERO -->
  <section class="hero">
    <h2>💖 Bem-vinda ao <span>GoathBet</span></h2>
    <p>Os melhores sinais, relatórios e gestão para turbinar sua banca.</p>
  </section>

  <!-- HUB DE CARDS -->
  <section class="hub-modulos">
    <div class="hub-card" onclick="abrirModal('gestao')">
      🧮 <h3>Gestão Financeira</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('velas')">
      📊 <h3>Relatórios de Velas</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('sinais')">
      🎯 <h3>Sinais de Entrada</h3>
    </div>
    <div class="hub-card" onclick="abrirModal('sorteios')">
      🎁 <h3>Sorteios</h3>
    </div>
    <div class="hub-card" onclick="window.location.href='planos.html'">
      💎 <h3>Planos</h3>
    </div>
    <div class="hub-card" onclick="irJogar()">
      🎮 <h3>Jogar</h3>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <p>© 2025 GoathBet - Todos os direitos reservados | Feito com 💜</p>
    <a href="login.html" class="btn-login">Entrar</a>
  </footer>

  <!-- MODAIS -->
  <!-- Gestão -->
  <div id="modal-gestao" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('gestao')">×</span>
      <h2>🧮 Gestão Financeira</h2>
      <p>Preencha os valores para controlar sua banca:</p>
      <input type="number" id="bancaInicial" placeholder="Banca inicial (R$)">
      <input type="number" id="valorEntrada" placeholder="Valor por entrada (R$)">
      <p id="resultadoGestao"></p>
      <button class="btn-primary" onclick="calcularGestao()">Calcular</button>
    </div>
  </div>

  <!-- Velas -->
  <div id="modal-velas" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('velas')">×</span>
      <h2>📊 Últimas Velas</h2>
      <div id="gridVelas"></div>
    </div>
  </div>

  <!-- Sinais -->
  <div id="modal-sinais" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sinais')">×</span>
      <h2>🎯 Sinais de Entrada</h2>
      <ul id="listaSinais"></ul>
    </div>
  </div>

  <!-- Sorteios -->
  <div id="modal-sorteios" class="modal">
    <div class="card-box">
      <span class="fechar" onclick="fecharModal('sorteios')">×</span>
      <h2>🎁 Sorteios Ativos</h2>
      <ul id="listaSorteios"></ul>
    </div>
  </div>

  <!-- SCRIPTS -->
  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { doc, getDoc, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Splash
    window.addEventListener("load", () => {
      setTimeout(()=>{ document.getElementById("splash").style.display="none"; }, 2500);
    });

    // Autenticação + Plano
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const ref = doc(db, "assinaturas", user.uid);
        const snap = await getDoc(ref);
        if (snap.exists() && snap.data().status === "ATIVO") {
          console.log("✅ Plano ativo, acesso liberado ao jogo.");
        } else {
          console.log("⚠ Sem plano ativo → Redirecionando para planos.");
          window.location.href = "planos.html";
        }
      }
    });

    // Modais
    window.abrirModal = (id)=>document.getElementById("modal-"+id).style.display="flex";
    window.fecharModal = (id)=>document.getElementById("modal-"+id).style.display="none";

    // Gestão financeira
    window.calcularGestao = () => {
      const banca = parseFloat(document.getElementById("bancaInicial").value)||0;
      const entrada = parseFloat(document.getElementById("valorEntrada").value)||0;
      if (banca>0 && entrada>0){
        document.getElementById("resultadoGestao").innerText = 
          `Você pode fazer ${Math.floor(banca/entrada)} entradas de R$${entrada.toFixed(2)}.`;
      }
    };

    // Velas em tempo real
    onSnapshot(collection(db,"velas"),(snap)=>{
      const grid=document.getElementById("gridVelas"); grid.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        grid.innerHTML+=`<div>${d.multiplicador}x <small>${hora}</small></div>`;
      });
    });

    // Sinais em tempo real
    onSnapshot(collection(db,"callsHistorico"),(snap)=>{
      const ul=document.getElementById("listaSinais"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        const hora=d.horario?.toDate?d.horario.toDate().toLocaleTimeString("pt-BR"):"--:--";
        ul.innerHTML+=`<li>${hora} → ${d.mult}x <span style="color:${d.status==='GREEN'?'#2ecc71':'#e74c3c'}">${d.status}</span></li>`;
      });
    });

    // Sorteios em tempo real
    onSnapshot(collection(db,"sorteios"),(snap)=>{
      const ul=document.getElementById("listaSorteios"); ul.innerHTML="";
      snap.forEach(docSnap=>{
        const d=docSnap.data();
        ul.innerHTML+=`<li>${d.nome} - ${d.status}</li>`;
      });
    });

    // Função Jogar (verifica login antes de abrir)
    window.irJogar = () => {
      if (auth.currentUser) {
        window.location.href = "dashboard.html"; // Usuário logado
      } else {
        window.location.href = "login.html"; // Usuário não logado
      }
    };
  </script>
</body>
</html>